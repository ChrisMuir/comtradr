<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Intro to comtradr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Intro to comtradr</h1>



<div id="package-information" class="section level2">
<h2>Package information</h2>
<p>API wrapper for the <a href="https://comtrade.un.org/data/">UN Comtrade Database</a>, which features inter-country trade data dating back to the early 1990’s. Full API documentation can be found <a href="https://comtrade.un.org/data/doc/api/">here</a>. This package allows users to interact with the API directly from R, and features functions for making queries and importing data.</p>
</div>
<div id="install-and-load-comtradr" class="section level2">
<h2>Install and load comtradr</h2>
<p>Install from CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;comtradr&quot;</span>)</code></pre></div>
<p>Or install the development version from GitHub:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ChrisMuir/comtradr&quot;</span>)</code></pre></div>
<p>Load comtradr</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(comtradr)</code></pre></div>
</div>
<div id="making-api-calls" class="section level2">
<h2>Making API calls</h2>
<p>Lets say we want to get data on all imports into the United States from Germany, France, Japan, and Mexico, for all years.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;USA&quot;</span>, 
               <span class="dt">partners =</span> <span class="kw">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), 
               <span class="dt">trade_direction =</span> <span class="st">&quot;imports&quot;</span>)

<span class="co"># API calls return a tidy data frame.</span>
<span class="kw">str</span>(q)
<span class="co">#&gt; 'data.frame':    0 obs. of  35 variables:</span>
<span class="co">#&gt;  $ classification        : logi </span>
<span class="co">#&gt;  $ year                  : logi </span>
<span class="co">#&gt;  $ period                : logi </span>
<span class="co">#&gt;  $ period_desc           : logi </span>
<span class="co">#&gt;  $ aggregate_level       : logi </span>
<span class="co">#&gt;  $ is_leaf_code          : logi </span>
<span class="co">#&gt;  $ trade_flow_code       : logi </span>
<span class="co">#&gt;  $ trade_flow            : logi </span>
<span class="co">#&gt;  $ reporter_code         : logi </span>
<span class="co">#&gt;  $ reporter              : logi </span>
<span class="co">#&gt;  $ reporter_iso          : logi </span>
<span class="co">#&gt;  $ partner_code          : logi </span>
<span class="co">#&gt;  $ partner               : logi </span>
<span class="co">#&gt;  $ partner_iso           : logi </span>
<span class="co">#&gt;  $ second_partner_code   : logi </span>
<span class="co">#&gt;  $ second_partner        : logi </span>
<span class="co">#&gt;  $ second_partner_iso    : logi </span>
<span class="co">#&gt;  $ customs_proc_code     : logi </span>
<span class="co">#&gt;  $ customs               : logi </span>
<span class="co">#&gt;  $ mode_of_transport_code: logi </span>
<span class="co">#&gt;  $ mode_of_transport     : logi </span>
<span class="co">#&gt;  $ commodity_code        : logi </span>
<span class="co">#&gt;  $ commodity             : logi </span>
<span class="co">#&gt;  $ qty_unit_code         : logi </span>
<span class="co">#&gt;  $ qty_unit              : logi </span>
<span class="co">#&gt;  $ alt_qty_unit_code     : logi </span>
<span class="co">#&gt;  $ alt_qty_unit          : logi </span>
<span class="co">#&gt;  $ qty                   : logi </span>
<span class="co">#&gt;  $ alt_qty               : logi </span>
<span class="co">#&gt;  $ netweight_kg          : logi </span>
<span class="co">#&gt;  $ gross_weight_kg       : logi </span>
<span class="co">#&gt;  $ trade_value_usd       : logi </span>
<span class="co">#&gt;  $ cif_trade_value_usd   : logi </span>
<span class="co">#&gt;  $ fob_trade_value_usd   : logi </span>
<span class="co">#&gt;  $ flag                  : logi </span>
<span class="co">#&gt;  - attr(*, &quot;url&quot;)= chr &quot;https://comtrade.un.org/api/get?max=50000&amp;type=C&amp;freq=A&amp;px=HS&amp;ps=all&amp;r=842&amp;p=276,251,392,484&amp;rg=1&amp;cc=TOTAL&amp;fmt=json&amp;head=H&quot;</span>
<span class="co">#&gt;  - attr(*, &quot;time_stamp&quot;)= POSIXct, format: &quot;2018-04-18 22:08:32&quot;</span>
<span class="co">#&gt;  - attr(*, &quot;req_duration&quot;)= num 144</span></code></pre></div>
<p>Here are a few more examples to show the different parameter options:</p>
<p>Limit the search range to shipments between 2010 and 2014.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;USA&quot;</span>, 
               <span class="dt">partners =</span> <span class="kw">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), 
               <span class="dt">trade_direction =</span> <span class="st">&quot;imports&quot;</span>, 
               <span class="dt">start_date =</span> <span class="dv">2010</span>, 
               <span class="dt">end_date =</span> <span class="dv">2014</span>)</code></pre></div>
<p>By default, the return data is in yearly amounts. We can pass <code>&quot;monthly&quot;</code> to arg <code>freq</code> to return data in monthly amounts, however the API limits each “monthly” query to a single year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get all monthly data for a single year (API max of 12 months per call).</span>
q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;USA&quot;</span>, 
               <span class="dt">partners =</span> <span class="kw">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), 
               <span class="dt">trade_direction =</span> <span class="st">&quot;imports&quot;</span>, 
               <span class="dt">start_date =</span> <span class="dv">2012</span>, 
               <span class="dt">end_date =</span> <span class="dv">2012</span>, 
               <span class="dt">freq =</span> <span class="st">&quot;monthly&quot;</span>)

<span class="co"># Get monthly data for a specific span of months (API max of five months per call).</span>
q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;USA&quot;</span>, 
               <span class="dt">partners =</span> <span class="kw">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), 
               <span class="dt">trade_direction =</span> <span class="st">&quot;imports&quot;</span>, 
               <span class="dt">start_date =</span> <span class="st">&quot;2012-03&quot;</span>, 
               <span class="dt">end_date =</span> <span class="st">&quot;2012-07&quot;</span>, 
               <span class="dt">freq =</span> <span class="st">&quot;monthly&quot;</span>)</code></pre></div>
<p>Countries passed to parameters <code>reporters</code> and <code>partners</code> must be spelled as they appear in the Comtrade country reference table. Function <code>ct_country_lookup</code> allows us to query the country reference table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_country_lookup</span>(<span class="st">&quot;korea&quot;</span>, <span class="st">&quot;reporter&quot;</span>)
<span class="co">#&gt; [1] &quot;Dem. People's Rep. of Korea&quot; &quot;Rep. of Korea&quot;</span>
<span class="kw">ct_country_lookup</span>(<span class="st">&quot;bolivia&quot;</span>, <span class="st">&quot;partner&quot;</span>)
<span class="co">#&gt; [1] &quot;Bolivia (Plurinational State of)&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;Rep. of Korea&quot;</span>, 
               <span class="dt">partners =</span> <span class="st">&quot;Bolivia (Plurinational State of)&quot;</span>, 
               <span class="dt">trade_direction =</span> <span class="st">&quot;all&quot;</span>)</code></pre></div>
<p>Search trade related to specific commodities (say, tomatoes). We can query the Comtrade commodity reference table to see all of the different commodity descriptions available for tomatoes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_commodity_lookup</span>(<span class="st">&quot;tomato&quot;</span>)
<span class="co">#&gt; $tomato</span>
<span class="co">#&gt; [1] &quot;0702 - Tomatoes; fresh or chilled&quot;                                                                                                         </span>
<span class="co">#&gt; [2] &quot;070200 - Vegetables; tomatoes, fresh or chilled&quot;                                                                                           </span>
<span class="co">#&gt; [3] &quot;2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid&quot;                                                           </span>
<span class="co">#&gt; [4] &quot;200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid&quot;             </span>
<span class="co">#&gt; [5] &quot;200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid&quot;</span>
<span class="co">#&gt; [6] &quot;200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter&quot;        </span>
<span class="co">#&gt; [7] &quot;210320 - Sauces; tomato ketchup and other tomato sauces&quot;</span></code></pre></div>
<p>If we want to search for shipment data on all of the commodity descriptions listed, then we can simply adjust the parameters for <code>ct_commodity_lookup</code> so that it will return only the codes, which can then be passed along to <code>ct_search</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tomato_codes &lt;-<span class="st"> </span><span class="kw">ct_commodity_lookup</span>(<span class="st">&quot;tomato&quot;</span>, 
                                    <span class="dt">return_code =</span> <span class="ot">TRUE</span>, 
                                    <span class="dt">return_char =</span> <span class="ot">TRUE</span>)

q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;USA&quot;</span>, 
               <span class="dt">partners =</span> <span class="kw">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), 
               <span class="dt">trade_direction =</span> <span class="st">&quot;all&quot;</span>, 
               <span class="dt">commod_codes =</span> tomato_codes)</code></pre></div>
<p>On the other hand, if we wanted to exclude juices and sauces from our search, we can pass a vector of the relevant codes to the API call.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> </span><span class="kw">ct_search</span>(<span class="dt">reporters =</span> <span class="st">&quot;USA&quot;</span>, 
               <span class="dt">partners =</span> <span class="kw">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), 
               <span class="dt">trade_direction =</span> <span class="st">&quot;all&quot;</span>, 
               <span class="dt">commod_codes =</span> <span class="kw">c</span>(<span class="st">&quot;0702&quot;</span>, <span class="st">&quot;070200&quot;</span>, <span class="st">&quot;2002&quot;</span>, <span class="st">&quot;200210&quot;</span>, <span class="st">&quot;200290&quot;</span>))</code></pre></div>
</div>
<div id="api-search-metadata" class="section level2">
<h2>API search metadata</h2>
<p>In addition to the trade data, each API return object contains metadata as attributes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The url of the API call.</span>
<span class="kw">attributes</span>(q)<span class="op">$</span>url
<span class="co">#&gt; [1] &quot;https://comtrade.un.org/api/get?max=50000&amp;type=C&amp;freq=A&amp;px=HS&amp;ps=all&amp;r=842&amp;p=276,251,484&amp;rg=all&amp;cc=0702,070200,2002,200210,200290&amp;fmt=json&amp;head=H&quot;</span>
<span class="co"># The date-time of the API call.</span>
<span class="kw">attributes</span>(q)<span class="op">$</span>time_stamp
<span class="co">#&gt; [1] &quot;2018-04-18 22:10:56 CDT&quot;</span>

<span class="co"># The total duration of the API call, in seconds.</span>
<span class="kw">attributes</span>(q)<span class="op">$</span>req_duration
<span class="co">#&gt; [1] 30.42061</span></code></pre></div>
</div>
<div id="more-on-the-lookup-functions" class="section level2">
<h2>More on the lookup functions</h2>
<p>Functions <code>ct_country_lookup</code> and <code>ct_commodity_lookup</code> are both able to take multiple search terms as input.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_country_lookup</span>(<span class="kw">c</span>(<span class="st">&quot;Belgium&quot;</span>, <span class="st">&quot;vietnam&quot;</span>, <span class="st">&quot;brazil&quot;</span>), <span class="st">&quot;reporter&quot;</span>)
<span class="co">#&gt; [1] &quot;Belgium&quot;                  &quot;Belgium-Luxembourg&quot;      </span>
<span class="co">#&gt; [3] &quot;Brazil&quot;                   &quot;Fmr Dem. Rep. of Vietnam&quot;</span>
<span class="co">#&gt; [5] &quot;Fmr Rep. of Vietnam&quot;</span>

<span class="kw">ct_commodity_lookup</span>(<span class="kw">c</span>(<span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;trout&quot;</span>), <span class="dt">return_char =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt;  [1] &quot;0702 - Tomatoes; fresh or chilled&quot;                                                                                                                                                                                                                                  </span>
<span class="co">#&gt;  [2] &quot;070200 - Vegetables; tomatoes, fresh or chilled&quot;                                                                                                                                                                                                                    </span>
<span class="co">#&gt;  [3] &quot;2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid&quot;                                                                                                                                                                                    </span>
<span class="co">#&gt;  [4] &quot;200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid&quot;                                                                                                                                      </span>
<span class="co">#&gt;  [5] &quot;200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid&quot;                                                                                                                         </span>
<span class="co">#&gt;  [6] &quot;200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter&quot;                                                                                                                                 </span>
<span class="co">#&gt;  [7] &quot;210320 - Sauces; tomato ketchup and other tomato sauces&quot;                                                                                                                                                                                                            </span>
<span class="co">#&gt;  [8] &quot;030191 - Fish; live, trout (salmo trutta, salmo gairdneri, salmo clarki, salmo aguabonita, salmo gilae)&quot;                                                                                                                                                            </span>
<span class="co">#&gt;  [9] &quot;030211 - Fish; trout (salmo trutta, salmo gairdneri, salmo clarki, salmo aguabonita, salmo gilae), fresh or chilled (excluding fillets, livers, roes and other fish meat of heading no. 0304)&quot;                                                                      </span>
<span class="co">#&gt; [10] &quot;030314 - Fish; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster), excluding fillets, meat of 0304, and edible fish offal of 0303.91 to 0303.99&quot;</span>
<span class="co">#&gt; [11] &quot;030321 - Fish; trout (salmo trutta, salmo gairdneri, salmo clarki, salmo aguabonita, salmo gilae), frozen (excluding fillets, livers, roes and other fish meat of heading no. 0304)&quot;                                                                                </span>
<span class="co">#&gt; [12] &quot;030442 - Fish fillets; fresh or chilled, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)&quot;                                                            </span>
<span class="co">#&gt; [13] &quot;030482 - Fish fillets; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)&quot;                                                                      </span>
<span class="co">#&gt; [14] &quot;030543 - Fish; smoked, whether or not cooked before or during smoking, trout (Salmo trutta, Oncorhynchus mykiss/clarki/aguabonita/gilae/apache/chrysogaster), includes fillets, but excludes edible fish offal&quot;</span></code></pre></div>
<p><code>ct_commodity_lookup</code> can return a vector (as seen above) or a named list, using parameter <code>return_char</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_commodity_lookup</span>(<span class="kw">c</span>(<span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;trout&quot;</span>), <span class="dt">return_char =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; $tomato</span>
<span class="co">#&gt; [1] &quot;0702 - Tomatoes; fresh or chilled&quot;                                                                                                         </span>
<span class="co">#&gt; [2] &quot;070200 - Vegetables; tomatoes, fresh or chilled&quot;                                                                                           </span>
<span class="co">#&gt; [3] &quot;2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid&quot;                                                           </span>
<span class="co">#&gt; [4] &quot;200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid&quot;             </span>
<span class="co">#&gt; [5] &quot;200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid&quot;</span>
<span class="co">#&gt; [6] &quot;200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter&quot;        </span>
<span class="co">#&gt; [7] &quot;210320 - Sauces; tomato ketchup and other tomato sauces&quot;                                                                                   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $trout</span>
<span class="co">#&gt; [1] &quot;030191 - Fish; live, trout (salmo trutta, salmo gairdneri, salmo clarki, salmo aguabonita, salmo gilae)&quot;                                                                                                                                                            </span>
<span class="co">#&gt; [2] &quot;030211 - Fish; trout (salmo trutta, salmo gairdneri, salmo clarki, salmo aguabonita, salmo gilae), fresh or chilled (excluding fillets, livers, roes and other fish meat of heading no. 0304)&quot;                                                                      </span>
<span class="co">#&gt; [3] &quot;030314 - Fish; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster), excluding fillets, meat of 0304, and edible fish offal of 0303.91 to 0303.99&quot;</span>
<span class="co">#&gt; [4] &quot;030321 - Fish; trout (salmo trutta, salmo gairdneri, salmo clarki, salmo aguabonita, salmo gilae), frozen (excluding fillets, livers, roes and other fish meat of heading no. 0304)&quot;                                                                                </span>
<span class="co">#&gt; [5] &quot;030442 - Fish fillets; fresh or chilled, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)&quot;                                                            </span>
<span class="co">#&gt; [6] &quot;030482 - Fish fillets; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)&quot;                                                                      </span>
<span class="co">#&gt; [7] &quot;030543 - Fish; smoked, whether or not cooked before or during smoking, trout (Salmo trutta, Oncorhynchus mykiss/clarki/aguabonita/gilae/apache/chrysogaster), includes fillets, but excludes edible fish offal&quot;</span></code></pre></div>
<p>For <code>ct_commodity_lookup</code>, if any of the input search terms return zero results and parameter <code>verbose</code> is set to <code>TRUE</code>, a warning will be printed to console (set <code>verbose</code> to <code>FALSE</code> to turn off this feature).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_commodity_lookup</span>(<span class="kw">c</span>(<span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;sldfkjkfdsklsd&quot;</span>), <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Warning: There were no matching results found for inputs: sldfkjkfdsklsd</span>
<span class="co">#&gt; $tomato</span>
<span class="co">#&gt; [1] &quot;0702 - Tomatoes; fresh or chilled&quot;                                                                                                         </span>
<span class="co">#&gt; [2] &quot;070200 - Vegetables; tomatoes, fresh or chilled&quot;                                                                                           </span>
<span class="co">#&gt; [3] &quot;2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid&quot;                                                           </span>
<span class="co">#&gt; [4] &quot;200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid&quot;             </span>
<span class="co">#&gt; [5] &quot;200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid&quot;</span>
<span class="co">#&gt; [6] &quot;200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter&quot;        </span>
<span class="co">#&gt; [7] &quot;210320 - Sauces; tomato ketchup and other tomato sauces&quot;                                                                                   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sldfkjkfdsklsd</span>
<span class="co">#&gt; character(0)</span></code></pre></div>
</div>
<div id="api-rate-limits" class="section level2">
<h2>API rate limits</h2>
<p>The Comtrade API imposes rate limits on both guest users and premium users. <code>comtradr</code> features automated throttling of API calls to ensure the user stays within the limits defined by Comtrade. Below is a breakdown of those limits, API docs on these details can be found <a href="https://comtrade.un.org/data/doc/api/#Authentication">here</a>.</p>
<ul>
<li>Without user token: 1 request per second, 100 requests per hour.</li>
<li>With valid user token: 1 request per second, 10,000 requests per hour.</li>
</ul>
<p>In addition to these rate limits, the API imposes some limits on parameter combinations.</p>
<ul>
<li>Between args <code>reporters</code>, <code>partners</code>, and the query date range, only one of these three may use the catch-all input “All”.</li>
<li>For the same group of three (<code>reporters</code>, <code>partners</code>, date range), if the input is not “All”, then the maximum number of input values for each is five. For date range, if not using “All”, then the <code>start_date</code> and <code>end_date</code> must not span more than five months or five years. There is one exception to this rule, if arg <code>freq</code> is “monthly”, then a single year can be passed to <code>start_date</code> and <code>end_date</code> and the API will return all of the monthly data for that year.</li>
<li>For arg <code>commod_codes</code>, if not using input “All”, then the maximum number of input values is 20 (although “All” is always a valid input).</li>
</ul>
<p>Additionally, the maximum number of returned records from a single query without a token is 50,000. With a token, that number is 250,000.</p>
<p><code>comtradr</code> features a few functions for working with the API rate limits and tokens.</p>
<ul>
<li><code>ct_register_token()</code> allows the user to set an API token within the package environment.</li>
<li><code>ct_get_remaining_hourly_queries()</code> will return the number of remaining queries for the current hour.</li>
<li><code>ct_get_reset_time()</code> will return the date/time in which the current hourly time limit will reset, as a <code>POSIXct</code> object.</li>
</ul>
</div>
<div id="package-data" class="section level2">
<h2>Package Data</h2>
<p><code>comtradr</code> ships with a few different package data objects, and functions for interacting with and using the package data.</p>
<p><strong>Country/Commodity Reference Tables</strong></p>
<p>As explained previously, making API calls with <code>comtradr</code> often requires the user to query the country reference table and/or the commodity reference table (this is done using functions <code>ct_country_lookup</code> and <code>ct_commodity_lookup</code>). Both of these reference tables are generated by the UN Comtrade, and are updated roughly once a year. Since they’re updated infrequently, both tables are saved as cached data objects within the <code>comtradr</code> package, and are referenced by the package functions when needed.</p>
<p><code>comtradr</code> features a function, <code>ct_update_databases</code>, for checking the Comtrade website for updates to either reference table. If updates are found, the function will download the updated table, save it to the package directory, and make it available during the current R session. It will also print a message indicating whether updates were found, like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_update_databases</span>()
<span class="co">#&gt; All DB's are up to date, no action required</span></code></pre></div>
<p>If any updates are found, the message will state which reference table(s) were updated.</p>
<p>The user may force download of both reference tables (regardless of whether updates exist) by using arg <code>force = TRUE</code> within function <code>ct_update_databases</code>. This is useful in the event that either reference table file is deleted or removed from the package directory. If this is the case, and either reference table file is not found upon package load, then any subsequent <code>comtradr</code> functions that require the use of a reference table will result in an error, with the error message prompting the user to run <code>ct_update_databases(force = TRUE)</code>.</p>
<p>Additionally, the Comtrade API features a number of different commodity reference tables, based on different trade data classification schemes (for more details, see <a href="https://comtrade.un.org/data/doc/api/#DataAvailabilityRequests">this</a> page from the API docs). <code>comtradr</code> ships with the commodity table for the “Harmonized System”, or “HS”, scheme. The user may download any of the available commodity tables by specifying arg <code>commodity_type</code> within function <code>ct_update_databases</code> (e.g., <code>ct_update_databases(commodity_type = &quot;SITC&quot;)</code> will download the commodity table that follows the “Standard International Trade Classification” scheme). Doing this will replace the commodity table on file with the one specified. To see the classification scheme of the commodity table currently on file, use <code>ct_commodity_db_type</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ct_commodity_db_type</span>()
<span class="co">#&gt; [1] &quot;HS&quot;</span></code></pre></div>
<p><strong>“Polished” Column Headers</strong></p>
<p><code>ct_pretty_cols</code> is a named vector of column header values that provide the option of using column headers that are more polished and human-friendly than those returned by the API function <code>ct_search</code>. The polished column headers may be useful when plotting the Comtrade data, or for use in publication tables. The data can be accessed directly by using <code>data(&quot;ct_pretty_cols&quot;)</code>, but there is also a function for applying the polished headers to <code>comtradr</code> data frames, <code>ct_use_pretty_cols</code>. Below is a quick demonstration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Column headers returned from function ct_search</span>
<span class="kw">colnames</span>(q)
<span class="co">#&gt;  [1] &quot;classification&quot;         &quot;year&quot;                  </span>
<span class="co">#&gt;  [3] &quot;period&quot;                 &quot;period_desc&quot;           </span>
<span class="co">#&gt;  [5] &quot;aggregate_level&quot;        &quot;is_leaf_code&quot;          </span>
<span class="co">#&gt;  [7] &quot;trade_flow_code&quot;        &quot;trade_flow&quot;            </span>
<span class="co">#&gt;  [9] &quot;reporter_code&quot;          &quot;reporter&quot;              </span>
<span class="co">#&gt; [11] &quot;reporter_iso&quot;           &quot;partner_code&quot;          </span>
<span class="co">#&gt; [13] &quot;partner&quot;                &quot;partner_iso&quot;           </span>
<span class="co">#&gt; [15] &quot;second_partner_code&quot;    &quot;second_partner&quot;        </span>
<span class="co">#&gt; [17] &quot;second_partner_iso&quot;     &quot;customs_proc_code&quot;     </span>
<span class="co">#&gt; [19] &quot;customs&quot;                &quot;mode_of_transport_code&quot;</span>
<span class="co">#&gt; [21] &quot;mode_of_transport&quot;      &quot;commodity_code&quot;        </span>
<span class="co">#&gt; [23] &quot;commodity&quot;              &quot;qty_unit_code&quot;         </span>
<span class="co">#&gt; [25] &quot;qty_unit&quot;               &quot;alt_qty_unit_code&quot;     </span>
<span class="co">#&gt; [27] &quot;alt_qty_unit&quot;           &quot;qty&quot;                   </span>
<span class="co">#&gt; [29] &quot;alt_qty&quot;                &quot;netweight_kg&quot;          </span>
<span class="co">#&gt; [31] &quot;gross_weight_kg&quot;        &quot;trade_value_usd&quot;       </span>
<span class="co">#&gt; [33] &quot;cif_trade_value_usd&quot;    &quot;fob_trade_value_usd&quot;   </span>
<span class="co">#&gt; [35] &quot;flag&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Apply polished column headers</span>
q &lt;-<span class="st"> </span><span class="kw">ct_use_pretty_cols</span>(q)

<span class="co"># Print new column headers.</span>
<span class="kw">colnames</span>(q)
<span class="co">#&gt;  [1] &quot;Classification&quot;               &quot;Year&quot;                        </span>
<span class="co">#&gt;  [3] &quot;Period&quot;                       &quot;Period Description&quot;          </span>
<span class="co">#&gt;  [5] &quot;Aggregate Level&quot;              &quot;Is Leaf Code&quot;                </span>
<span class="co">#&gt;  [7] &quot;Trade Flow Code&quot;              &quot;Trade Flow&quot;                  </span>
<span class="co">#&gt;  [9] &quot;Reporter Code&quot;                &quot;Reporter Country&quot;            </span>
<span class="co">#&gt; [11] &quot;Reporter ISO&quot;                 &quot;Partner Code&quot;                </span>
<span class="co">#&gt; [13] &quot;Partner Country&quot;              &quot;Partner ISO&quot;                 </span>
<span class="co">#&gt; [15] &quot;Second Partner Code&quot;          &quot;Second Partner Country&quot;      </span>
<span class="co">#&gt; [17] &quot;Second Partner ISO&quot;           &quot;Customs Procurement Code&quot;    </span>
<span class="co">#&gt; [19] &quot;Customs&quot;                      &quot;Mode of Transportation Code&quot; </span>
<span class="co">#&gt; [21] &quot;Mode of Transportation&quot;       &quot;Commodity Code&quot;              </span>
<span class="co">#&gt; [23] &quot;Commodity&quot;                    &quot;Quantity Unit Code&quot;          </span>
<span class="co">#&gt; [25] &quot;Quantity Unit&quot;                &quot;Alternate Quantity Unit Code&quot;</span>
<span class="co">#&gt; [27] &quot;Alternate Quantity Unit&quot;      &quot;Quantity&quot;                    </span>
<span class="co">#&gt; [29] &quot;Alternate Quantity&quot;           &quot;Net Weight kg&quot;               </span>
<span class="co">#&gt; [31] &quot;Gross Weight kg&quot;              &quot;Trade Value usd&quot;             </span>
<span class="co">#&gt; [33] &quot;CIF Trade Value usd&quot;          &quot;FOB Trade Value usd&quot;         </span>
<span class="co">#&gt; [35] &quot;Flag&quot;</span></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
